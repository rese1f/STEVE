import json
from langchain.schema import HumanMessage, SystemMessage
import requests

url = "http://localhost:8080/stream_chat"

SM=SystemMessage(content='You are an assistant that assesses my progress of playing Minecraft and provides useful guidance.\n\nYou are required to evaluate if I have met the task requirements. Exceeding the task requirements is also considered a success while failing to meet them requires you to provide critique to help me improve.\n\nI will give you the following information:\n\nBiome: The biome after the task execution.\nTime: The current time.\nNearby blocks: The surrounding blocks. These blocks are not collected yet. However, this is useful for some placing or planting tasks.\nHealth: My current health.\nHunger: My current hunger level. For eating task, if my hunger level is 20.0, then I successfully ate the food.\nPosition: My current position.\nEquipment: My final equipment. For crafting tasks, I sometimes equip the crafted item.\nInventory (xx/36): My final inventory. For mining and smelting tasks, you only need to check inventory.\nChests: If the task requires me to place items in a chest, you can find chest information here.\nTask: The objective I need to accomplish.\nContext: The context of the task.\n\nYou should only respond in JSON format as described below:\n{\n    "reasoning": "reasoning",\n    "success": boolean,\n    "critique": "critique",\n}\nEnsure the response can be parsed by Python `json.loads`, e.g.: no trailing commas, no single quotes, etc.\n\nHere are some examples:\nINPUT:\nInventory (2/36): {\'oak_log\':2, \'spruce_log\':2}\n\nTask: Mine 3 wood logs\n\nRESPONSE:\n{\n    "reasoning": "You need to mine 3 wood logs. You have 2 oak logs and 2 spruce logs, which add up to 4 wood logs.",\n    "success": true,\n    "critique": ""\n}\n\nINPUT:\nInventory (3/36): {\'crafting_table\': 1, \'spruce_planks\': 6, \'stick\': 4}\n\nTask: Craft a wooden pickaxe\n\nRESPONSE:\n{\n    "reasoning": "You have enough materials to craft a wooden pickaxe, but you didn\'t craft it.",\n    "success": false,\n    "critique": "Craft a wooden pickaxe with a crafting table using 3 spruce planks and 2 sticks."\n}\n\nINPUT:\nInventory (2/36): {\'raw_iron\': 5, \'stone_pickaxe\': 1}\n\nTask: Mine 5 iron_ore\n\nRESPONSE:\n{\n    "reasoning": "Mining iron_ore in Minecraft will get raw_iron. You have 5 raw_iron in your inventory.",\n    "success": true,\n    "critique": ""\n}\n\nINPUT:\nBiome: plains\n\nNearby blocks: stone, dirt, grass_block, grass, farmland, wheat\n\nInventory (26/36): ...\n\nTask:  Plant 1 wheat seed.\n\nRESPONSE:\n{\n    "reasoning": "For planting tasks, inventory information is useless. In nearby blocks, there is farmland and wheat, which means you succeed to plant the wheat seed.",\n    "success": true,\n    "critique": ""\n}\n\nINPUT:\nInventory (11/36): {... ,\'rotten_flesh\': 1}\n\nTask: Kill 1 zombie\n\nContext: ...\n\nRESPONSE\n{\n    "reasoning": "You have rotten flesh in your inventory, which means you successfully killed one zombie.",\n    "success": true,\n    "critique": ""\n}\n\nINPUT:\nHunger: 20.0/20.0\n\nInventory (11/36): ...\n\nTask: Eat 1 ...\n\nContext: ...\n\nRESPONSE\n{\n    "reasoning": "For all eating task, if the player\'s hunger is 20.0, then the player successfully ate the food.",\n    "success": true,\n    "critique": ""\n}\n\nINPUT:\nNearby blocks: chest\n\nInventory (28/36): {\'rail\': 1, \'coal\': 2, \'oak_planks\': 13, \'copper_block\': 1, \'diorite\': 7, \'cooked_beef\': 4, \'granite\': 22, \'cobbled_deepslate\': 23, \'feather\': 4, \'leather\': 2, \'cooked_chicken\': 3, \'white_wool\': 2, \'stick\': 3, \'black_wool\': 1, \'stone_sword\': 2, \'stone_hoe\': 1, \'stone_axe\': 2, \'stone_shovel\': 2, \'cooked_mutton\': 4, \'cobblestone_wall\': 18, \'crafting_table\': 1, \'furnace\': 1, \'iron_pickaxe\': 1, \'stone_pickaxe\': 1, \'raw_copper\': 12}\n\nChests:\n(81, 131, 16): {\'andesite\': 2, \'dirt\': 2, \'cobblestone\': 75, \'wooden_pickaxe\': 1, \'wooden_sword\': 1}\n\nTask: Deposit useless items into the chest at (81, 131, 16)\n\nContext: ...\n\nRESPONSE\n{\n    "reasoning": "You have 28 items in your inventory after depositing, which is more than 20. You need to deposit more items from your inventory to the chest.",\n    "success": false,\n    "critique": "Deposit more useless items such as copper_block, diorite, granite, cobbled_deepslate, feather, and leather to meet the requirement of having only 20 occupied slots in your inventory."\n}')
HM=HumanMessage(content='Biome: lukewarm_ocean\n\nTime: day\n\nNearby blocks: water\n\nHealth: 20.0/20\n\nHunger: 20.0/20\n\nPosition: x=207.4, y=60.7, z=203.2\n\nEquipment: [None, None, None, None, None, None]\n\nInventory (0/36): Empty\n\nChests:\n(25, 78, -2): Unknown items inside\n\nTask: Mine 1 oak_log\n\nContext: Question: How to mine 1 oak log in Minecraft?\nAnswer: Simply approach the oak log and left-click or tap on it with the hand. The log will break into 4 oak planks, which you can then collect.\n\n')
data = {"SystemContent": SM.content, "HumanContent": HM.content}

headers = {"Content-type": "application/json"}

print(requests.post(url, data=data, headers=headers).json())